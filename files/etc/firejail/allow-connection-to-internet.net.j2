
##########################################################################
#
# The following iptables rules allows the container to connect to the
# public Internet but NOT local area network reachable by the host.
#

*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT DROP [0:0]
-A INPUT -i lo -j ACCEPT
-A INPUT -s {{ software_firejail_network_address|ipaddr('address') }} -j ACCEPT
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -p icmp --icmp-type destination-unreachable -j ACCEPT
-A INPUT -p icmp --icmp-type time-exceeded -j ACCEPT
-A INPUT -p icmp --icmp-type echo-request -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A OUTPUT -d {{ software_firejail_network_address|ipaddr('address') }} -p tcp --dport 53 -j ACCEPT
-A OUTPUT -d {{ software_firejail_network_address|ipaddr('address') }} -p udp --dport 53 -j ACCEPT
-A OUTPUT -d 10.0.0.0/8 -j DROP
-A OUTPUT -d 172.16.0.0/12 -j DROP
-A OUTPUT -d 192.168.0.0/16 -j DROP
-A OUTPUT -j ACCEPT
COMMIT

