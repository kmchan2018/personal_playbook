#!/bin/bash

{% if hardware_video_offload_device|default(false) != false %}
{% if hardware_video_offload_kernel_module == "nvidia" %}
# Nvidia driver does not support render offload for wayland applications,
# only Xwayland ones. Therefore, force the use of Xwayland.
unset WAYLAND_DISPLAY

{% endif %}
export DRI_PRIME=1
export __NV_PRIME_RENDER_OFFLOAD=1
export __GLX_VENDOR_LIBRARY_NAME={{ hardware_video_offload_glx_vendor_library_name }}
export __EGL_VENDOR_LIBRARY_FILENAMES={% for filename in hardware_video_offload_egl_vendor_library_filenames -%}
{%- if loop.first == false -%}:{%- endif -%}
{%- if filename|first != "/" -%}
/usr/share/glvnd/egl_vendor.d/{{ filename }}
{%- else -%}
{{ filename }}
{%- endif -%}
{%- endfor %}

VK_ICD_FILENAMES={% for filename in hardware_video_offload_vk_icd_filenames -%}
{%- if loop.first == false -%}:{%- endif -%}
{%- if filename|first != "/" -%}
/usr/share/vulkan/icd.d/{{ filename }}
{%- else -%}
{{ filename }}
{%- endif -%}
{%- endfor %}

{% endif %}

exec "$@"

